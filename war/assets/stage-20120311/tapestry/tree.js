T5.extend(T5,{tree:{ANIMATION_RATE:0.005,MAX_ANIMATION_DURATION:0.5,TOGGLE_TYPE:"blind",QUEUE_NAME:"t-tree-updates"}});T5.extendInitializers(function(){var b=T5.tree;function a(g){var f=$(g).up("li").down("ul");var i=f.getDimensions();var h=Math.min(i.height*b.ANIMATION_RATE,b.MAX_ANIMATION_DURATION);new Effect.toggle(f,b.TOGGLE_TYPE,{duration:h,queue:{position:"end",scope:b.QUEUE_NAME}})}function c(f){$(f).addClassName("t-tree-expanded");a(f)}function e(f){$(f).removeClassName("t-tree-expanded");a(f)}function d(h){var k=h.expanded||h.leaf;var g=h.expanded;var m=false;if(g){$(h.clientId).addClassName("t-tree-expanded")}function j(o){$(h.clientId).update("");$(h.clientId).removeClassName("t-empty-node");var n=o.responseJSON;Tapestry.loadScriptsInReply(n,function(){var q=$(h.clientId).up("li");var p=q.down("span.t-tree-label");p.insert({after:n.content});q.down("ul").hide();c(h.clientId);m=false;k=true;g=true})}function f(){if(m){return}m=true;$(h.clientId).addClassName("t-empty-node");$(h.clientId).update("<span class='t-ajax-wait'/>");Tapestry.ajaxRequest(h.expandChildrenURL,j)}$(h.clientId).observe("click",function(o){o.stop();if(!k&&h.expandChildrenURL){f();return}var p=g?e:c;p.call(null,h.clientId);var n=g?h.markCollapsedURL:h.markExpandedURL;Tapestry.ajaxRequest(n,{});g=!g});if(h.selectURL){var l=h.selected;var i=$(h.clientId).next("span.t-tree-label");i.addClassName("t-selectable");if(l){i.addClassName("t-selected-leaf-node-label")}i.observe("click",function(n){n.stop();l=!l;if(l){i.addClassName("t-selected-leaf-node-label")}else{i.removeClassName("t-selected-leaf-node-label")}Tapestry.ajaxRequest(h.selectURL,{parameters:{"t:selected":l}})})}}return{treeNode:d}});