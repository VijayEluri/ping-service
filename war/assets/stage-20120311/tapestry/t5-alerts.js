T5.extendInitializers(function(){var f=T5.$;var b=T5.dom.observe;var g=T5.dom.find;var e="tapestry:dismiss-all";var c=T5.pubsub.createPublisher(T5.events.ADD_ALERT,document);function a(h,i){f(h).innerHTML="<div class='t-alert-container'></div><div class='t-alert-controls'><a href='#'>"+i+"</a></div>";var k=g(h,"div");var j=g(h,"a");T5.dom.publishEvent(j,"click",e);return k}function d(h){var j=true;var k=false;var i=null;T5.sub(e,null,function(){if(k){j=false;T5.dom.hide(h.id);j=false;T5.dom.removeChildren(i);Tapestry.ajaxRequest(h.dismissURL)}});T5.sub(T5.events.ADD_ALERT,null,function(m){if(!k){i=a(h.id,h.dismissText);k=true}if(!j){T5.dom.show(h.id);j=true}var o=new Element("div",{"class":m["class"]}).update("<div class='t-dismiss' title='Dismiss'></div><div class='t-message-container'>"+m.message+"</div>");i.insert({bottom:o});var n=g(o,".t-dismiss");function l(){T5.dom.remove(o);if(i.innerHTML==""){T5.dom.hide(h.id);j=false}}if(m["transient"]){setTimeout(l,T5.alerts.TRANSIENT_DELAY)}b(n,"click",function(p){p.stop();l();if(m.id){Tapestry.ajaxRequest(h.dismissURL,{parameters:{id:m.id}})}})})}return{alertManager:d,addAlert:c}});T5.define("alerts",{TRANSIENT_DELAY:15000});